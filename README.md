# gomodel [![wercker status](https://app.wercker.com/status/9c6ef0eec7d6d217bd831bbdc3a3ace2/s "wercker status")](https://app.wercker.com/project/bykey/9c6ef0eec7d6d217bd831bbdc3a3ace2) [![GoDoc](https://godoc.org/github.com/cosiner/gomodel?status.png)](http://godoc.org/github.com/cosiner/gomodel)
gomodel provide another method to interact with database.   
Instead of reflection, use bitset represent fields of CRUD, sql/stmt cache and generate model code for you, high performance.

# Install
```sh
$ go get github.com/cosiner/gomodel
$ cd /path/of/gomodel/cmd/gomodel
$ go install # it will install the gomodel binary file to your $GOPATH/bin
$ gomodel -cp # copy model.tmpl to default path $HOME/.config/go/model.tmpl
              # or just put it to your model package, gomodel will search it first 
```

The [gomodel cmd tool and SQL convertion for structures](https://github.com/cosiner/gomodel/tree/master/cmd/gomodel).

# Example
```Go
type User struct {
    Id int `column:"user_id"`
    Age int
    Name string
}
```
```sh
$ gomodel -model -sql user.go
```
Generated:
```Go
const (
    USER_ID uint = 1 << iota
    USER_AGE
    USER_NAME
    userFieldsEnd = iota
    userFieldsAll = 1 << userFieldsEnd - 1
)
```
etc...

* __DB__
```Go
db := gomodel.NewDB()
```
* __Insert__
```Go
u := &User{Age:1, Name:"abcde"}
id, err := db.Insert(u, USER_AGE|USER_NAME, gomodel.RES_ID)
u.Id = id
err = dberrors.DuplicateKeyError(err, UserNameCol, ErrUserNameExists)
```

* __Delete__
```Go
u := &User{Id:1, Age:20}
c, err := db.Delete(u, USER_ID|USER_AGE)
err = dberrors.NoAffects(c, err, ErrNoUser)
```

* __Update__
```Go
u := &User{Id:1, Age:5, Name:"abcde"}
c, err := db.Update(u, USER_AGE|USER_NAME, USER_ID) // update age by id
err = dberrors.NoAffects(c, err, ErrNoUser)
```

* __One__
```Go
u := &User{Id:1}
userFieldsExcpId := userFieldsAll & (^USER_ID)
err := db.One(u, userFieldsExcpId, USER_ID) // select one by id
err = dberrors.NoRows(err, ErrNoUser)
```

* __Limit__
```Go
u := &User{Age:10}
us := &users{Fields:userFieldsAll} // users is generated by gomodel
err := db.Limit(&us, u, userFieldsAll, USER_AGE, 0, 10)
return us.Values, dberrors.NoRows(err, ErrNoUser)
```

* __All__
```Go
u := &User{Age:10}
us := &users{Fields:userFieldsAll} // users is generated by gomodel
err := db.All(&us, u, userFieldsAll, USER_AGE)
return us.Values, dberrors.NoRows(err, ErrNoUser)
```

# LICENSE
MIT.
